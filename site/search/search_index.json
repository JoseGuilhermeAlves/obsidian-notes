{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Bem vindo ao MkDocs da Phd","text":"<p>Para a documenta\u00e7\u00e3o completa, visite mkdocs.org.</p>"},{"location":"#comandos","title":"Comandos","text":"<ul> <li><code>mkdocs new [nome-do-diret\u00f3rio]</code> - Cria um novo projeto</li> <li><code>mkdocs serve</code> - Inicia o servidor de documenta\u00e7\u00e3o com recarregamento autom\u00e1tico.</li> <li><code>mkdocs build</code> - Gera o site de documenta\u00e7\u00e3o.</li> <li><code>mkdocs -h</code> - Exibe a mensagem de ajuda e sai.</li> </ul>"},{"location":"#estrutura-do-projeto","title":"Estrutura do projeto","text":"<pre><code>mkdocs.yml    # O arquivo de configura\u00e7\u00e3o.  \ndocs/  \n    index.md  # A p\u00e1gina inicial da documenta\u00e7\u00e3o.  \n    ...       # Outras p\u00e1ginas em Markdown, imagens e outros arquivos.\n</code></pre>"},{"location":"SistemasPHD/SistemasPHD/Relatorio%20Dinamico/","title":"Relatorio Dinamico","text":""},{"location":"SistemasPHD/SistemasPHD/Relatorio%20Dinamico/#cadastros","title":"Cadastros","text":"<p>Nome da aba alterado para Permiss\u00f5es; Bot\u00e3o Novo alinhado com o fim da linha; Substitu\u00eddo o filtrar por pesquisar. </p> <p>Alterado a sele\u00e7\u00e3o de empresa para combo </p>"},{"location":"SistemasPHD/SistemasPHD/Relatorio%20Dinamico/#modal-de-permissao-do-usuario","title":"Modal de Permiss\u00e3o do Usu\u00e1rio","text":"<p>Alterado para combo e o nome da modal; Corrigido o a busca por nome de usu\u00e1rio. </p>"},{"location":"SistemasPHD/SistemasPHD/Relatorio%20Dinamico/#relatorios-dinamicos","title":"Relat\u00f3rios Din\u00e2micos","text":"<p>Exemplo com o Participante, adicionado a separa\u00e7\u00e3o. </p>"},{"location":"SistemasPHD/SistemasPHD/Relat%C3%B3rios%20Din%C3%A2micos/","title":"Relat\u00f3rios Din\u00e2micos","text":"<ul> <li>[x] criar um jrxml</li> <li>[x] gerar relatorio sem filtro</li> <li>[x] gerar relatorio com filtro</li> <li>[x] adicionar um segundo filtro ao mesmo relat\u00f3rio</li> <li> <p>[ ] Testar todos os tipos de filtro para confirmar se est\u00e3o funcionando:</p> <ul> <li>[x] input</li> <li>[x] combo</li> <li>[x] radio</li> <li>[x] modal</li> <li>[x] data</li> <li>[x] periodo</li> <li>[x] checkbox</li> <li>[x] combo mes</li> <li>[ ] modal 2 niveis (depois)</li> <li>[ ] modal - check box (depois)</li> <li>[x] combo - rerender</li> </ul> </li> <li> <p>[x] Tirar duvidas sobre os arquivos adicionais</p> </li> <li>[x] Verificar quais modais precisam ser adicionadas e quais nao, atuais s\u00e3o:<ul> <li>[ ] slc Produto</li> <li>[ ] slc Marca</li> <li>[ ] slc Familia</li> <li>[x] slc Participante (criar)</li> <li>[ ] slc Rede</li> <li>[ ] slc Vendedor</li> <li>[ ] slc Fabricante2NiveisMarca</li> <li>[ ] slc MarcaFabricante2Niveis</li> <li>[ ] slc Fabricante</li> <li>[ ] slc CnpjLojas</li> <li>[ ] slc ParticipanteCompleto</li> </ul> </li> <li>[x] Corrigir o diret\u00f3rio de salvamento do jrxml</li> <li>[x] acertos para carregar filtros</li> <li>[x] permissao dos usuarios</li> <li>[x] verificar o filtro :empCoEmpresa</li> <li>[x] modal participante</li> <li> <p>[x] substituir arquivos adicionais (cadastro de relatorio) por permissoes do usuario.</p> </li> <li> <p>[x] Alterar para modal a sele\u00e7\u00e3o de usu\u00e1rio</p> </li> </ul> <p>Aba de Permissao: ![[Pasted image 20250127160332.png]]</p> <p>Modal:</p> <p>![[Pasted image 20250127160342.png]]</p> <ul> <li>[x] botao a direita</li> <li>[x] verificar o filtro usuario na modal de cadastro</li> <li>[x] mudar para combo</li> <li>[x] Coalesce nome fantasia nome da empresa</li> </ul>"},{"location":"SistemasPHD/SistemasPHD/Tabelas%20do%20banco%20Issue%2049%20-%20portal/","title":"Tabelas do banco Issue 49   portal","text":"<p>SYS_RELATORIO_PORTAL SYS_RELATORIO_ARQ_ADD_PORTAL SYS_FILTRO_PORTAL SYS_RELATORIO_FILTRO_PORTAL SYS_USUARIO_RELATORIO</p>"},{"location":"SistemasPHD/SistemasPHD/TomCat%209%20configura%C3%A7%C3%B5es%20de%20seguran%C3%A7a/","title":"TomCat 9 configura\u00e7\u00f5es de seguran\u00e7a","text":"<p>1- Remo\u00e7\u00e3o do Index.html (Solu\u00e7\u00e3o do item 1 de NFE_CONTINGENCY_PROD DRAFT REPORT) Removemos ele para ningu\u00e9m ter acesso a tela inicial do tomcat, abrindo a possibilidade de acessar a lista de aplica\u00e7\u00f5es e outras configura\u00e7\u00f5es.</p> <p>Para isso, basta comentar as seguintes linhas do arquivo conf/web.xml</p> <pre><code>  &lt;!-- &lt;welcome-file-list&gt;  \n\u00a0 \u00a0 \u00a0 \u00a0 &lt;welcome-file&gt;index.html&lt;/welcome-file&gt;  \n\u00a0 \u00a0 \u00a0 \u00a0 &lt;welcome-file&gt;index.htm&lt;/welcome-file&gt;  \n\u00a0 \u00a0 \u00a0 \u00a0 &lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt;  \n\u00a0 \u00a0 &lt;/welcome-file-list&gt; --&gt;\n</code></pre> <p>Tamb\u00e9m \u00e9 poss\u00edvel aumentar ainda mais a seguran\u00e7a ocultando informa\u00e7\u00f5es do servidor de aplica\u00e7\u00e3o que aparecem quando uma p\u00e1gina est\u00e1 indispon\u00edvel. Ao criar o diret\u00f3rio apache-tomcat-9.0.94\\lib\\org\\apache\\catalina\\util podemos criar o arquivo ServerInfo.properties e adicionar os seguintes par\u00e2metros a ele:\u00a0</p> <pre><code>server.info=  \nserver.number=  \nserver.built=\n</code></pre> <p>Assim o resultado final ao acessar diretamente localhost:8080/ (por exemplo) o resultado ser\u00e1 esse: </p> <p>2- Desabilitando m\u00e9todos TRACE e OPTIONS (Inseguros) (solu\u00e7\u00e3o de \u201cCross-Site Scripting (XSS)\u201d informado pelo Discord): desabilitando esses m\u00e9todos HTTP que podem ser usados para ataque XSS. O c\u00f3digo a seguir deve ser adicionado ao web.xml mas ele n\u00e3o desabilita o m\u00e9todo em si, ele s\u00f3 exige uma autentica\u00e7\u00e3o, mas como o \u00a0<code>auth-constraint</code> n\u00e3o possui regra, ningu\u00e9m ter\u00e1 permiss\u00e3o para usar os m\u00e9todos.</p> <pre><code>&lt;security-constraint&gt;\u00a0\n&lt;web-resource-collection&gt;\u00a0\n&lt;web-resource-name&gt;Disable HTTP Methods&lt;/web-resource-name&gt; &lt;url-pattern&gt;/*&lt;/url-pattern&gt;\u00a0\n&lt;http-method&gt;TRACE&lt;/http-method&gt;\u00a0\n&lt;http-method&gt;OPTIONS&lt;/http-method&gt;\u00a0\n&lt;/web-resource-collection&gt;\u00a0\n&lt;auth-constraint/&gt;\u00a0\n&lt;/security-constraint&gt;\n</code></pre> <p>3- Adicionando cabe\u00e7alhos de resposta HTTP (Solu\u00e7\u00e3o do item 4 de NFE_CONTINGENCY_PROD DRAFT REPORT):</p> <p>Usados para mitigar os tipos mais comuns de ataques, como MIME e ClickJacking. basta adicionar ao arquivo web.xml</p> <pre><code>  &lt;filter&gt;  \n\u00a0 &lt;filter-name&gt;SecurityHeadersFilter&lt;/filter-name&gt;  \n\u00a0 &lt;filter-class&gt;org.apache.catalina.filters.HttpHeaderSecurityFilter&lt;/filter-class&gt;  \n\u00a0 &lt;init-param&gt;  \n\u00a0 \u00a0 &lt;param-name&gt;antiClickJackingEnabled&lt;/param-name&gt;  \n\u00a0 \u00a0 &lt;param-value&gt;true&lt;/param-value&gt;  \n\u00a0 &lt;/init-param&gt;  \n\u00a0 &lt;init-param&gt;  \n\u00a0 \u00a0 &lt;param-name&gt;antiClickJackingOption&lt;/param-name&gt;  \n\u00a0 \u00a0 &lt;param-value&gt;SAMEORIGIN&lt;/param-value&gt;  \n\u00a0 &lt;/init-param&gt;  \n\u00a0 &lt;init-param&gt;  \n\u00a0 \u00a0 &lt;param-name&gt;blockContentTypeSniffingEnabled&lt;/param-name&gt;  \n\u00a0 \u00a0 &lt;param-value&gt;true&lt;/param-value&gt;  \n\u00a0 &lt;/init-param&gt;  \n&lt;/filter&gt;  \n&lt;filter-mapping&gt;  \n\u00a0 &lt;filter-name&gt;SecurityHeadersFilter&lt;/filter-name&gt;  \n\u00a0 &lt;url-pattern&gt;/*&lt;/url-pattern&gt;  \n&lt;/filter-mapping&gt;\n</code></pre> <p>4-(PERFORMANCE) Deve ser avaliado o uso do GZIP:</p> <p>GZIP \u00e9 um sistema de compress\u00e3o de arquivos usado para aumentar a velocidade da resposta das requisi\u00e7\u00f5es HTTP, beneficiando clientes com conex\u00f5es mais lentas.</p> <p>Alerta: A compress\u00e3o economiza na largura de banda e tamb\u00e9m na velocidade da resposta a custo de aumentar o uso de CPU (ainda a ser calculado), recomendado n\u00e3o habilitar agora antes de ser averiguado se o Tomcat reduzir\u00e1 o uso de CPU do servidor.</p> <p>Para habilitar o GZIP \u00e9 necessario adicionar o atributo compression=\u201don\u201d no Conector presente no arquivo web.xml, como a seguir:  </p> <pre><code>  &lt;Connector port=\"8080\" protocol=\"HTTP/1.1\" connectionTimeout=\"20000\" redirectPort=\"8443\" compression=\"on\" /&gt;\n</code></pre> <p>5- Desabilitando o SSLv3 (Solu\u00e7\u00e3o do item 5, 6 e 7 de NFE_CONTINGENCY_PROD DRAFT REPORT):</p> <p>Desabilitando o protocolo pois ele possui uma falha que \u00e9 utilizada para ataques Poodle, para isso devemos alterar o arquivo server. xml, adicionando no Connector as propriedades sslEnabledProtocols, passando os protocolos que podem ser usados e ciphers (opcional) que s\u00e3o conjuntos de criptografia utilizados para aumentar a seguran\u00e7a.</p> <pre><code>  &lt;Connector port=\"8443\" protocol=\"org.apache.coyote.http11.Http11NioProtocol\"  \n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 maxThreads=\"150\" SSLEnabled=\"true\"  \n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 maxParameterCount=\"1000\"  \n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 sslEnabledProtocols=\"TLSv1.2,TLSv1.3\"  \n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 ciphers=\"TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,  \n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,  \n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256,  \n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384\"  \n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 &gt;\n</code></pre>"},{"location":"SistemasPHD/SistemasPHD/0%20Issues/Issue%20378%20-%20Lentid%C3%A3o%20nos%20relat%C3%B3rios%20111%20e%20129/","title":"Issue 378   Lentid\u00e3o nos relat\u00f3rios 111 e 129","text":"<p>Ada\u00edza solicitou revis\u00e3o na gera\u00e7\u00e3o dos relat\u00f3rios 111 e 129. Ao gerar um relat\u00f3rio por exemplo: Prudente (464) / 01/07/2024 - 30/07/2024 S\u00e3o mais de 120 mil linhas mas o arquivo xlsx fica muito lento. Em alguns testes, mesmo gerando sem nenhuma formata\u00e7\u00e3o o problema continua.</p> <p>Dessa forma penso em duas possibilidades:</p> <ol> <li> <p>Atualizar a vers\u00e3o do jasper. Hoje usamos a 5.6.0 e j\u00e1 est\u00e3o na vers\u00e3o 7.0.0 O iReport n\u00e3o acompanha mais essa vers\u00e3o, teria que usar o editor JasperReports Studio. O Teste foi muito bom, usando 6.21.3. Arquivo xlsx gerado com menor tamanho e muito r\u00e1pido para abrir. Mas tem que confirmar se d\u00e1 pra usar essa vers\u00e3o do jasper com java 8</p> </li> <li> <p>N\u00e3o mexer na vers\u00e3o do jasper e colocar outra forma de exporta\u00e7\u00e3o al\u00e9m de PDF e Excel, seria CSV Dessa forma cria um arquivo simples e elas importam no excel que j\u00e1 vai criar com os filtros e deve resolver essa lentid\u00e3o</p> </li> </ol> <p>Fiz a atualiza\u00e7\u00e3o das bibliotecas do JasperReport para a vers\u00e3o 6.21 e adicionado tamb\u00e9m suas depend\u00eancias, depois de alterar o c\u00f3digo com as novas regras das classes foi feito o teste para gerar o relat\u00f3rio.</p>"},{"location":"SistemasPHD/SistemasPHD/0%20Issues/Issue%20378%20-%20Lentid%C3%A3o%20nos%20relat%C3%B3rios%20111%20e%20129/#falhas","title":"Falhas","text":"<ul> <li>Atualizar o JasperReport n\u00e3o resultou em nenhuma melhoria consider\u00e1vel, foi gerado um arquivo de cada um dos relat\u00f3rios mencionados usando o CNPJ de Avar\u00e9 Loja 1, com o per\u00edodo de 01/01/2016 at\u00e9 29/02/2016, com cerca de 110mil linhas, tais arquivos demoraram cerca de 10 minutos para abrir pelo excel. </li> <li>Outras tentativas foram realizadas, como remover as bordas das c\u00e9lulas para diminuir elementos que o excel carregava ao abrir o arquivo, tamb\u00e9m sem sucesso.</li> </ul>"},{"location":"SistemasPHD/SistemasPHD/0%20Issues/Issue%20378%20-%20Lentid%C3%A3o%20nos%20relat%C3%B3rios%20111%20e%20129/#sucessos","title":"Sucessos","text":"<ul> <li>Por ultimo, usando ainda o JasperReport 6.21, foi alterado o tipo de arquivo para ser gerado como .csv, essa alternativa fez o arquivo abrir quase sem atraso (quest\u00e3o de menos de 10 segundos)</li> <li>Feito tambem a importa\u00e7\u00e3o do arquivo para o Excel para ver se n\u00e3o prejudicava na forma como os dados eram exibidos ao serem importados, nenhum dado foi comprometido, e a a\u00e7\u00e3o foi quase imediata, com exce\u00e7\u00e3o de se tratar de um arquivo de texto, ent\u00e3o n\u00e3o importou com bordas das c\u00e9lulas</li> </ul>"},{"location":"SistemasPHD/SistemasPHD/0%20Issues/Issue%20378%20-%20Lentid%C3%A3o%20nos%20relat%C3%B3rios%20111%20e%20129/#conclusao-minha","title":"Conclus\u00e3o minha","text":"<p>O ideal no caso seria adicionar a op\u00e7\u00e3o de .csv na gera\u00e7\u00e3o do arquivo, pelo menos nos casos de relat\u00f3rios que s\u00e3o muito grandes, e orientar nesses casos a fazer a importa\u00e7\u00e3o para o Excel.</p> <p>Ao usar essa abordagem pode ser feito a atualiza\u00e7\u00e3o do Jasper para a vers\u00e3o 6.21 ou mantida a vers\u00e3o 5.6 que est\u00e1 no sistema</p> <p>Criado uma condi\u00e7\u00e3o onde caso o relat\u00f3rio tenha por padr\u00e3o o tipo de gera\u00e7\u00e3o em Excel e n\u00e3o permita escolher outro tipo de gera\u00e7\u00e3o, ainda assim ser\u00e1 poss\u00edvel escolher entre Excel e Csv (o formato PDF n\u00e3o ser\u00e1 exibido).</p> <p>![[Pasted image 20241204151959.png]] REL_IN_TIPO_GERACAO = tipo padr\u00e3o de gera\u00e7\u00e3o (E = Excel) REL_IN_EXIBIR_TIPO_GERACAO = permite mudar o tipo, anteriormente entre PDF e Excel</p> <p>Agora os relat\u00f3rios 111 e 129 ter\u00e3o o seguinte campo:</p> <p>![[Pasted image 20241204150526.png]] ![[Pasted image 20241204150604.png]]</p> <p>O texto de ajuda embaixo da sele\u00e7\u00e3o \u00e9 uma sugest\u00e3o, apenas para o usu\u00e1rio estar ciente da melhor forma de gerar relat\u00f3rios grandes como os mencionados na descri\u00e7\u00e3o da issue.</p> <p>Foi testado a gera\u00e7\u00e3o dos relat\u00f3rios em CSV e exportados para excel, sem perda de dados, quebra na formata\u00e7\u00e3o ou colunas desalinhadas. os headers foram mantidos mas sem estiliza\u00e7\u00e3o: ![[Pasted image 20241204151039.png]]</p> <p>a gera\u00e7\u00e3o em CSV tambem pode ser inclu\u00edda nos demais relat\u00f3rios que possuem tipo de gera\u00e7\u00e3o com PDF tambem ![[Pasted image 20241204151650.png]]</p>"},{"location":"SistemasPHD/SistemasPHD/0%20Issues/Issue%20402%20-%20Compara%C3%A7%C3%A3o%20dos%20Select%27s%20SEM%20e%20COM%20o%20%C3%ADndice/","title":"Select's usados","text":""},{"location":"SistemasPHD/SistemasPHD/0%20Issues/Issue%20402%20-%20Compara%C3%A7%C3%A3o%20dos%20Select%27s%20SEM%20e%20COM%20o%20%C3%ADndice/#select-antigo","title":"Select Antigo","text":"<p>O primeiro select \u00e9 a antiga forma de compara\u00e7\u00e3o usado em outros casos do sistema, comparando o 1 com o retorno do case. Foi inclu\u00eddo a data como filtro para a compara\u00e7\u00e3o fazer sentido.</p> <pre><code>Explain plan for\nSELECT\n    SUB_NFE_IDENTIFICACAO.*,\n    Nvl(SUB_NFE_TOTAL.NFT_VL_TOTAL_NFE, 0) AS vlTotalNfe,\n    COUNT(*) OVER() AS totalLinhas\nFROM\n    (\n        SELECT\n            nfe.*\n        FROM\n            NFE_IDENTIFICACAO nfe\n            LEFT JOIN NFE_IDENTIFICA_DESTINATARIO dest\n            on(\n            nfe.EMI_CO_CNPJ = dest.EMI_CO_CNPJ\n            and nfe.NID_CO_NFE = dest.NID_CO_NFE\n            and nfe.UNF_CO_SERIE = dest.UNF_CO_SERIE\n            and nfe.UNF_CO_Modelo = dest.UNF_CO_Modelo)\n        WHERE\n        nfe.EMI_CO_CNPJ = 2183783000111\n        AND 1 = (\n            CASE\n                WHEN -1 = -1 THEN 1\n                WHEN -1 = dest.PTC_CO_CNPJ THEN 1\n                ELSE 0\n            END\n        )\n        and nfe.NID_IN_AMBIENTE = 1\n        and 1 = (\n            CASE\n                when '-1' = '-1' then 1\n                when '-1' = nfe.NID_IN_Status then 1\n                else 0\n            end\n        )\n        and 1 = (\n            CASE\n                when -1 = -1 then 1\n                when -1 = nfe.NID_CO_NFE  then 1\n                else 0\n            end\n        )\n        and 1 = (\n            CASE\n                when -1 = -1 then 1\n                when -1 = nfe.ope_Co_Operacao  then 1\n                else 0\n            end\n        )\n        and nfe.NID_DT_EMISSAO BETWEEN \n        TO_DATE('01/08/2024', 'DD/MM/YYYY') AND \n        TO_DATE('15/12/2024', 'DD/MM/YYYY')\n    ) SUB_NFE_IDENTIFICACAO\n    LEFT JOIN (\n        SELECT\n            NFE_TOTAL.*\n        FROM\n            NFE_TOTAL\n        WHERE\n            EMI_CO_CNPJ = 2183783000111\n    ) SUB_NFE_TOTAL ON (\n    SUB_NFE_IDENTIFICACAO.EMI_CO_CNPJ = SUB_NFE_TOTAL.EMI_CO_CNPJ\n    AND SUB_NFE_IDENTIFICACAO.UNF_CO_MODELO = SUB_NFE_TOTAL.UNF_CO_MODELO\n    AND SUB_NFE_IDENTIFICACAO.UNF_CO_SERIE = SUB_NFE_TOTAL.UNF_CO_SERIE\n    AND SUB_NFE_IDENTIFICACAO.NID_CO_NFE = SUB_NFE_TOTAL.NID_CO_NFE\n    AND SUB_NFE_IDENTIFICACAO.NID_IN_AMBIENTE = SUB_NFE_TOTAL.NID_IN_AMBIENTE\n    )\nORDER BY\n    SUB_NFE_IDENTIFICACAO.nid_Dt_Emissao DESC,\n    SUB_NFE_IDENTIFICACAO.unf_Co_Modelo ASC,\n    SUB_NFE_IDENTIFICACAO.unf_Co_Serie ASC,\n    SUB_NFE_IDENTIFICACAO.nid_Co_Nfe DESC;\n\nSELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);\n</code></pre>"},{"location":"SistemasPHD/SistemasPHD/0%20Issues/Issue%20402%20-%20Compara%C3%A7%C3%A3o%20dos%20Select%27s%20SEM%20e%20COM%20o%20%C3%ADndice/#select-novo","title":"Select Novo","text":"<p>Usando a coluna a esquerda para assim dar prefer\u00eancia ao uso de \u00edndice.</p> <pre><code>explain plan for\nSELECT\n    SUB_NFE_IDENTIFICACAO.*,\n    Nvl(SUB_NFE_TOTAL.NFT_VL_TOTAL_NFE, 0) AS vlTotalNfe,\n    COUNT(*) OVER() AS totalLinhas\nFROM\n    (\n        SELECT\n            nfe.*\n        FROM\n            NFE_IDENTIFICACAO nfe\n            LEFT JOIN NFE_IDENTIFICA_DESTINATARIO dest on(\n                nfe.EMI_CO_CNPJ = dest.EMI_CO_CNPJ\n                and nfe.NID_CO_NFE = dest.NID_CO_NFE\n                and nfe.UNF_CO_SERIE = dest.UNF_CO_SERIE\n                and nfe.UNF_CO_Modelo = dest.UNF_CO_Modelo\n            )\n        WHERE\n        NVL(dest.PTC_CO_CNPJ, -1) = (\n            CASE\n                WHEN -1 = -1 THEN NVL(dest.PTC_CO_CNPJ, -1)\n                else -1\n            END\n        )\n        and nfe.EMI_CO_CNPJ = 2183783000111\n\n        and nfe.NID_IN_AMBIENTE = 1\n        and nfe.NID_IN_STATUS = (\n            CASE\n                WHEN '-1' = '-1' THEN nfe.NID_IN_STATUS\n                else '-1'\n            END\n        )\n        and nfe.NID_CO_NFE = (\n            CASE\n                WHEN -1 = -1 THEN nfe.NID_CO_NFE\n                else -1\n            END\n        )\n        and nfe.ope_Co_Operacao = (\n            CASE\n                WHEN -1 = -1 THEN nfe.ope_Co_Operacao\n                else -1\n            END\n        )\n        and nfe.NID_DT_EMISSAO BETWEEN TO_DATE('01/08/2024', 'DD/MM/YYYY')\n        AND TO_DATE('15/12/2024', 'DD/MM/YYYY')\n    ) SUB_NFE_IDENTIFICACAO\n    LEFT JOIN (\n        SELECT\n            NFE_TOTAL.*\n        FROM\n            NFE_TOTAL\n        WHERE\n            EMI_CO_CNPJ = 2183783000111\n    ) SUB_NFE_TOTAL ON (\n        SUB_NFE_IDENTIFICACAO.EMI_CO_CNPJ = SUB_NFE_TOTAL.EMI_CO_CNPJ\n        AND SUB_NFE_IDENTIFICACAO.UNF_CO_MODELO = SUB_NFE_TOTAL.UNF_CO_MODELO\n        AND SUB_NFE_IDENTIFICACAO.UNF_CO_SERIE = SUB_NFE_TOTAL.UNF_CO_SERIE\n        AND SUB_NFE_IDENTIFICACAO.NID_CO_NFE = SUB_NFE_TOTAL.NID_CO_NFE\n        AND SUB_NFE_IDENTIFICACAO.NID_IN_AMBIENTE = SUB_NFE_TOTAL.NID_IN_AMBIENTE\n    )\nORDER BY\n    SUB_NFE_IDENTIFICACAO.nid_Dt_Emissao DESC,\n    SUB_NFE_IDENTIFICACAO.unf_Co_Modelo ASC,\n    SUB_NFE_IDENTIFICACAO.unf_Co_Serie ASC,\n    SUB_NFE_IDENTIFICACAO.nid_Co_Nfe DESC;\n\nSELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);\n</code></pre>"},{"location":"SistemasPHD/SistemasPHD/0%20Issues/Issue%20402%20-%20Compara%C3%A7%C3%A3o%20dos%20Select%27s%20SEM%20e%20COM%20o%20%C3%ADndice/#sem-indice","title":"Sem \u00cdndice","text":""},{"location":"SistemasPHD/SistemasPHD/0%20Issues/Issue%20402%20-%20Compara%C3%A7%C3%A3o%20dos%20Select%27s%20SEM%20e%20COM%20o%20%C3%ADndice/#select-antigo_1","title":"Select Antigo","text":"<p>Plano de explica\u00e7\u00e3o retornado: ![[Pasted image 20241211115521.png]]</p>"},{"location":"SistemasPHD/SistemasPHD/0%20Issues/Issue%20402%20-%20Compara%C3%A7%C3%A3o%20dos%20Select%27s%20SEM%20e%20COM%20o%20%C3%ADndice/#select-novo_1","title":"Select Novo","text":"<p>Plano de explica\u00e7\u00e3o retornado: ![[Pasted image 20241211120007.png]]</p>"},{"location":"SistemasPHD/SistemasPHD/0%20Issues/Issue%20402%20-%20Compara%C3%A7%C3%A3o%20dos%20Select%27s%20SEM%20e%20COM%20o%20%C3%ADndice/#com-o-indice","title":"Com o \u00cdndice","text":"<p>Nesse caso foi criado o \u00edndice atrav\u00e9s do comando </p> <pre><code>create index ind_Nfe_filtro_data on NFE_IDENTIFICACAO(NID_DT_EMISSAO);\n</code></pre>"},{"location":"SistemasPHD/SistemasPHD/0%20Issues/Issue%20402%20-%20Compara%C3%A7%C3%A3o%20dos%20Select%27s%20SEM%20e%20COM%20o%20%C3%ADndice/#select-antigo_2","title":"Select Antigo","text":"<p>Plano de explica\u00e7\u00e3o retornado: ![[Pasted image 20241211120600.png]]</p>"},{"location":"SistemasPHD/SistemasPHD/0%20Issues/Issue%20402%20-%20Compara%C3%A7%C3%A3o%20dos%20Select%27s%20SEM%20e%20COM%20o%20%C3%ADndice/#select-novo_2","title":"Select Novo","text":"<p>Plano de explica\u00e7\u00e3o retornado: ![[Pasted image 20241211120645.png]]</p>"},{"location":"SistemasPHD/SistemasPHD/0%20Issues/Issue%20402%20-%20Filtro%20Unificado%20Nfe/","title":"Issue 402   Filtro Unificado Nfe","text":"<p>Principal altera\u00e7\u00e3o a ser documentada aqui \u00e9 a altera\u00e7\u00e3o no select, n\u00e3o s\u00f3 foi unificado todos os filtros para um s\u00f3 select e adicionado o filtro de data, como tambem a altera\u00e7\u00e3o dos CASES para a compara\u00e7\u00e3o de valores dos filtros.</p> <pre><code>SELECT\n    SUB_NFE_IDENTIFICACAO.*,\n    Nvl(SUB_NFE_TOTAL.NFT_VL_TOTAL_NFE, 0) AS vlTotalNfe,\n    COUNT(*) OVER() AS totalLinhas\nFROM\n    (\n        SELECT\n            nfe.*\n        FROM\n            NFE_IDENTIFICACAO nfe\n            LEFT JOIN NFE_IDENTIFICA_DESTINATARIO dest on(\n                nfe.EMI_CO_CNPJ = dest.EMI_CO_CNPJ\n                and nfe.NID_CO_NFE = dest.NID_CO_NFE\n                and nfe.UNF_CO_SERIE = dest.UNF_CO_SERIE\n                and nfe.UNF_CO_Modelo = dest.UNF_CO_Modelo\n            )\n        WHERE\n            nfe.EMI_CO_CNPJ = :emiCoCnpj\n            AND NVL(dest.PTC_CO_CNPJ, -1) = (\n                CASE\n                    WHEN :ptcCoCnpj = -1 THEN NVL(dest.PTC_CO_CNPJ, -1)\n                    else TO_NUMBER(:ptcCoCnpj)\n                END\n            )\n            and nfe.NID_IN_AMBIENTE = :nidInAmbiente\n            and nfe.NID_IN_STATUS = (\n                CASE\n                    WHEN :nidInStatus = -1 THEN nfe.NID_IN_STATUS\n                    else :nidInStatus\n                END\n            )\n            and nfe.NID_CO_NFE = (\n                CASE\n                    WHEN TO_NUMBER(:nidCoNfe) = -1 THEN nfe.NID_CO_NFE\n                    else TO_NUMBER(:nidCoNfe)\n                END\n            )\n            and nfe.ope_Co_Operacao = (\n                CASE\n                    WHEN TO_NUMBER(:opeCoOperacao) = -1 THEN nfe.ope_Co_Operacao\n                    else TO_NUMBER(:opeCoOperacao)\n                END\n            )\n            and nfe.NID_DT_EMISSAO BETWEEN TO_DATE(:dtPerInicio, 'DD/MM/YYYY')\n            AND TO_DATE(:dtPerFinal, 'DD/MM/YYYY')\n    ) SUB_NFE_IDENTIFICACAO\n    LEFT JOIN (\n        SELECT\n            NFE_TOTAL.*\n        FROM\n            NFE_TOTAL\n        WHERE\n            EMI_CO_CNPJ = :emiCoCnpj\n    ) SUB_NFE_TOTAL ON (\n        SUB_NFE_IDENTIFICACAO.EMI_CO_CNPJ = SUB_NFE_TOTAL.EMI_CO_CNPJ\n        AND SUB_NFE_IDENTIFICACAO.UNF_CO_MODELO = SUB_NFE_TOTAL.UNF_CO_MODELO\n        AND SUB_NFE_IDENTIFICACAO.UNF_CO_SERIE = SUB_NFE_TOTAL.UNF_CO_SERIE\n        AND SUB_NFE_IDENTIFICACAO.NID_CO_NFE = SUB_NFE_TOTAL.NID_CO_NFE\n        AND SUB_NFE_IDENTIFICACAO.NID_IN_AMBIENTE = SUB_NFE_TOTAL.NID_IN_AMBIENTE\n    )\nORDER BY\n    SUB_NFE_IDENTIFICACAO.nid_Dt_Emissao DESC,\n    SUB_NFE_IDENTIFICACAO.unf_Co_Modelo ASC,\n    SUB_NFE_IDENTIFICACAO.unf_Co_Serie ASC,\n    SUB_NFE_IDENTIFICACAO.nid_Co_Nfe DESC\n</code></pre> <p>A altera\u00e7\u00e3o reduziu o custo das opera\u00e7\u00f5es em aproximadamente 30%, diminuindo de 46 para 32 na maioria dos casos.</p> <p>Um caso especifico foi o filtro do Participante:</p> <pre><code>AND NVL(dest.PTC_CO_CNPJ, -1) = (\n    CASE\n        WHEN :ptcCoCnpj = -1 THEN NVL(dest.PTC_CO_CNPJ, -1)\n        else TO_NUMBER(:ptcCoCnpj)\n    END\n)\n</code></pre> <p>Como nem todas as notas possuem obrigatoriamente o Participante declarado no momento de sua cria\u00e7\u00e3o, ele pode ser <code>null</code> em alguns casos, ent\u00e3o foi adaptado essa condi\u00e7\u00e3o usando NVL para trazer os registros com o Participante <code>null</code> caso o valor informado no filtro for -1.</p> <p>Um problema em particular foi detectado, quando usado os par\u00e2metros fixos como o CNPJ da loja ao inv\u00e9s de :emiCoCnpj, os valores de custo aumentavam consideravelmente (para 843). Por\u00e9m durante as pesquisas, foi constatado que o valor apresentado pelo explain plan \u00e9 generalizado e nem sempre reflete no resultado final, fazendo as consultas o resultado de tempo era semelhante.</p> <p>Como o uso de index pode ser melhor aproveitado em tabelas extensas com volumes de dados altos e tambem em caso de filtragens especificas, foi considerado que seria melhor optar pelo index.</p> <p>Para contornar o problema dos par\u00e2metros fixos, foi criado o seguinte index para a tabela NFE_IDENTIFICACAO</p> <pre><code>create index ind_nfe_filtro_data on NFE_IDENTIFICACAO(NID_DT_EMISSAO);\n</code></pre> <p>Oque reduziu o custo da opera\u00e7\u00e3o de 843 para 35 e o tempo de consulta usando o filtro do ano de 2012 at\u00e9 2024 reduziu de 3,33 segundos para cerca de 1,7 segundos;</p> <p>Foi incluso somente a data de emiss\u00e3o no index usando como base os conselhos dessa pergunta no Stack Overflow. Tamb\u00e9m foi optado por colocar apenas uma coluna pois o index por mais que seja eficiente para melhorar a velocidade de consultas, ele pode acabar atrasando a velocidade de UPDATE's, INSERT's E DELETE's</p> <p>O Select usado para o teste:</p> <pre><code>SELECT\n    SUB_NFE_IDENTIFICACAO.*,\n    Nvl(SUB_NFE_TOTAL.NFT_VL_TOTAL_NFE, 0) AS vlTotalNfe,\n    COUNT(*) OVER() AS totalLinhas\nFROM\n    (\n        SELECT\n            nfe.*\n        FROM\n            NFE_IDENTIFICACAO nfe\n            LEFT JOIN NFE_IDENTIFICA_DESTINATARIO dest on(\n                nfe.EMI_CO_CNPJ = dest.EMI_CO_CNPJ\n                and nfe.NID_CO_NFE = dest.NID_CO_NFE\n                and nfe.UNF_CO_SERIE = dest.UNF_CO_SERIE\n                and nfe.UNF_CO_Modelo = dest.UNF_CO_Modelo\n            )\n        WHERE\n            NVL(dest.PTC_CO_CNPJ, -1) = (\n                CASE\n                    WHEN -1 = -1 THEN NVL(dest.PTC_CO_CNPJ, -1)\n                    else -1\n                END\n            )\n            and nfe.EMI_CO_CNPJ = 2183783000111\n\n            and nfe.NID_IN_AMBIENTE = 1\n            and nfe.NID_IN_STATUS = (\n                CASE\n                    WHEN '-1' = -1 THEN nfe.NID_IN_STATUS\n                    else '-1'\n                END\n            )\n            and nfe.NID_CO_NFE = (\n                CASE\n                    WHEN -1 = -1 THEN nfe.NID_CO_NFE\n                    else -1\n                END\n            )\n            and nfe.ope_Co_Operacao = (\n                CASE\n                    WHEN -1 = -1 THEN nfe.ope_Co_Operacao\n                    else -1\n                END\n            )\n            and nfe.NID_DT_EMISSAO BETWEEN TO_DATE('01/08/2024', 'DD/MM/YYYY')\n            AND TO_DATE('15/12/2024', 'DD/MM/YYYY')\n    ) SUB_NFE_IDENTIFICACAO\n    LEFT JOIN (\n        SELECT\n            NFE_TOTAL.*\n        FROM\n            NFE_TOTAL\n        WHERE\n            EMI_CO_CNPJ = 2183783000111\n    ) SUB_NFE_TOTAL ON (\n        SUB_NFE_IDENTIFICACAO.EMI_CO_CNPJ = SUB_NFE_TOTAL.EMI_CO_CNPJ\n        AND SUB_NFE_IDENTIFICACAO.UNF_CO_MODELO = SUB_NFE_TOTAL.UNF_CO_MODELO\n        AND SUB_NFE_IDENTIFICACAO.UNF_CO_SERIE = SUB_NFE_TOTAL.UNF_CO_SERIE\n        AND SUB_NFE_IDENTIFICACAO.NID_CO_NFE = SUB_NFE_TOTAL.NID_CO_NFE\n        AND SUB_NFE_IDENTIFICACAO.NID_IN_AMBIENTE = SUB_NFE_TOTAL.NID_IN_AMBIENTE\n    )\nORDER BY\n    SUB_NFE_IDENTIFICACAO.nid_Dt_Emissao DESC,\n    SUB_NFE_IDENTIFICACAO.unf_Co_Modelo ASC,\n    SUB_NFE_IDENTIFICACAO.unf_Co_Serie ASC,\n    SUB_NFE_IDENTIFICACAO.nid_Co_Nfe DESC;\n</code></pre>"},{"location":"SistemasPHD/SistemasPHD/Indice/Modal/","title":"Modal","text":"<p>[[Adicionando 'n\u00edvel' a modal]] [[Modal com Scroll]]</p>"},{"location":"SistemasPHD/SistemasPHD/Modal/Adicionando%20%27n%C3%ADvel%27%20a%20modal/","title":"Adicionando 'n\u00edvel' a modal","text":"<p>quando precisar abrir a modal dentro de outra, para pode calibrar o z-index da modal e do backdrop (fundo cinza) use o seguinte trecho de c\u00f3digo:</p> <pre><code>&lt;script&gt;\n    $jq('#idDaModal').on(\"shown.bs.modal\", function (e) {\n        $jq(this).last().css('z-index', 1070);\n        $jq('.modal-backdrop').last().css('z-index', 1060);\n    });\n&lt;/script&gt;\n</code></pre> <ul> <li>substitua '#idDaModal' pelo id da Modal que voce est\u00e1 abrindo</li> </ul>"},{"location":"SistemasPHD/SistemasPHD/Modal/Modal%20com%20Scroll/","title":"Modal com Scroll","text":"<p>Para adicionar o scroll no interior da modal e n\u00e3o na direita da pagina, use os seguintes passos:</p> <ul> <li>Na div de conteudo da modal, adicione a seguinte propriedade style: 'style=\"height: auto !important; max-height: calc(100vh - 26vh) !important;'</li> <li>E na tag form adicione a classe 'overflow-auto'</li> </ul> <p>Dessa forma seu c\u00f3digo deve ficar pr\u00f3ximo a isso</p> <pre><code>&lt;div class=\"modal-dialog ui-modal\" role=\"document\"&gt;\n    &lt;div class=\"modal-content\" style=\"height: auto !important; max-height: calc(100vh - 26vh) !important;\"&gt;\n        &lt;div class=\"modal-header\"&gt;\n            CONTEUDO DO HEADER\n        &lt;/div&gt;\n        &lt;div class=\"modal-body\"&gt;\n            &lt;h:form id=\"frm#{modalPanelId}\" styleClass=\"overflow-auto\" enctype=\"multipart/form-data\"&gt;\n                CONTEUDO DO FORM\n            &lt;/h:form&gt;\n         &lt;/div&gt;\n     &lt;/div&gt;\n&lt;/div&gt;\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0\n</code></pre>"},{"location":"SistemasPHD/SistemasPHD/SQLs/Primeiro%20Select%2C%20usando%20Case/","title":"Primeiro Select, usando Case","text":"<pre><code>    SELECT\n        SUB_NFE_IDENTIFICACAO.*,\n        Nvl(SUB_NFE_TOTAL.NFT_VL_TOTAL_NFE, 0) AS vlTotalNfe,\n        COUNT(*) OVER() AS totalLinhas\n    FROM\n        (\n            SELECT\n                nfe.*\n            FROM\n                NFE_IDENTIFICACAO nfe\n                LEFT JOIN NFE_IDENTIFICA_DESTINATARIO dest\n                on(\n                nfe.EMI_CO_CNPJ = dest.EMI_CO_CNPJ\n                and nfe.NID_CO_NFE = dest.NID_CO_NFE\n                and nfe.UNF_CO_SERIE = dest.UNF_CO_SERIE\n                and nfe.UNF_CO_Modelo = dest.UNF_CO_Modelo)\n            WHERE\n                nfe.EMI_CO_CNPJ = :emiCoCnpj\n                AND 1 = (\n                    CASE\n                        WHEN :ptcCoCnpj = -1 THEN 1\n                        WHEN :ptcCoCnpj = dest.PTC_CO_CNPJ THEN 1\n                        ELSE 0\n                    END\n                )\n                and nfe.NID_IN_AMBIENTE = :nidInAmbiente\n                and 1 = (\n                    CASE\n                        when :nidInStatus = -1 then 1\n                        when :nidInStatus = nfe.NID_IN_Status then 1\n                        else 0\n                    end\n                )\n                and 1 = (\n                    CASE\n                        when :nidCoNfe = -1 then 1\n                        when :nidCoNfe = nfe.NID_CO_NFE  then 1\n                        else 0\n                    end\n                )\n                and 1 = (\n                    CASE\n                        when :opeCoOperacao = -1 then 1\n                        when :opeCoOperacao = nfe.ope_Co_Operacao  then 1\n                        else 0\n                    end\n                )\n                and nfe.NID_DT_EMISSAO BETWEEN TO_DATE(:dtPerInicio, 'DD/MM/YYYY') AND TO_DATE(:dtPerFinal, 'DD/MM/YYYY')\n        ) SUB_NFE_IDENTIFICACAO\n        LEFT JOIN (\n            SELECT\n                NFE_TOTAL.*\n            FROM\n                NFE_TOTAL\n            WHERE\n                EMI_CO_CNPJ = :emiCoCnpj\n        ) SUB_NFE_TOTAL ON (\n            SUB_NFE_IDENTIFICACAO.EMI_CO_CNPJ = SUB_NFE_TOTAL.EMI_CO_CNPJ\n            AND SUB_NFE_IDENTIFICACAO.UNF_CO_MODELO = SUB_NFE_TOTAL.UNF_CO_MODELO\n            AND SUB_NFE_IDENTIFICACAO.UNF_CO_SERIE = SUB_NFE_TOTAL.UNF_CO_SERIE\n            AND SUB_NFE_IDENTIFICACAO.NID_CO_NFE = SUB_NFE_TOTAL.NID_CO_NFE\n            AND SUB_NFE_IDENTIFICACAO.NID_IN_AMBIENTE = SUB_NFE_TOTAL.NID_IN_AMBIENTE\n        )\n    ORDER BY\n        SUB_NFE_IDENTIFICACAO.nid_Dt_Emissao DESC,\n        SUB_NFE_IDENTIFICACAO.unf_Co_Modelo ASC,\n        SUB_NFE_IDENTIFICACAO.unf_Co_Serie ASC,\n        SUB_NFE_IDENTIFICACAO.nid_Co_Nfe DESC\n</code></pre>"},{"location":"SistemasPHD/SistemasPHD/SQLs/Segundo%20Select/","title":"Segundo Select","text":"<pre><code>SELECT\n    SUB_NFE_IDENTIFICACAO.*,\n    Nvl(SUB_NFE_TOTAL.NFT_VL_TOTAL_NFE, 0) AS vlTotalNfe,\n    COUNT(*) OVER() AS totalLinhas\nFROM\n(\n        SELECT\n            nfe.*\n        FROM\n            NFE_IDENTIFICACAO nfe\n            LEFT JOIN NFE_IDENTIFICA_DESTINATARIO dest on(\n                nfe.EMI_CO_CNPJ = dest.EMI_CO_CNPJ\n                and nfe.NID_CO_NFE = dest.NID_CO_NFE\n                and nfe.UNF_CO_SERIE = dest.UNF_CO_SERIE\n                and nfe.UNF_CO_Modelo = dest.UNF_CO_Modelo\n            )\n        WHERE\n            nfe.EMI_CO_CNPJ = :emiCoCnpj\n            and (dest.PTC_CO_CNPJ = :ptcCoCnpj or (:ptcCoCnpj = -1))\n            and nfe.NID_IN_AMBIENTE = :nidInAmbiente\n            and (nfe.NID_IN_Status = :nidInStatus or (:nidInStatus = -1))\n            and (nfe.NID_CO_NFE = :nidCoNfe OR (:nidCoNfe = -1))\n            and (nfe.ope_Co_Operacao = :opeCoOperacao or (:opeCoOperacao = -1))\n            and nfe.NID_DT_EMISSAO BETWEEN TO_DATE(:dtPerInicio, 'DD/MM/YYYY')\n            AND TO_DATE(:dtPerFinal, 'DD/MM/YYYY')\n    ) SUB_NFE_IDENTIFICACAO\n    LEFT JOIN (\n        SELECT\n            NFE_TOTAL.*\n        FROM\n            NFE_TOTAL\n        WHERE\n            EMI_CO_CNPJ = :emiCoCnpj\n    ) SUB_NFE_TOTAL ON (\n        SUB_NFE_IDENTIFICACAO.EMI_CO_CNPJ = SUB_NFE_TOTAL.EMI_CO_CNPJ\n        AND SUB_NFE_IDENTIFICACAO.UNF_CO_MODELO = SUB_NFE_TOTAL.UNF_CO_MODELO\n        AND SUB_NFE_IDENTIFICACAO.UNF_CO_SERIE = SUB_NFE_TOTAL.UNF_CO_SERIE\n        AND SUB_NFE_IDENTIFICACAO.NID_CO_NFE = SUB_NFE_TOTAL.NID_CO_NFE\n        AND SUB_NFE_IDENTIFICACAO.NID_IN_AMBIENTE = SUB_NFE_TOTAL.NID_IN_AMBIENTE\n    )\nORDER BY\n    SUB_NFE_IDENTIFICACAO.nid_Dt_Emissao DESC,\n    SUB_NFE_IDENTIFICACAO.unf_Co_Modelo ASC,\n    SUB_NFE_IDENTIFICACAO.unf_Co_Serie ASC,\n    SUB_NFE_IDENTIFICACAO.nid_Co_Nfe DESC\n</code></pre>"}]}